{% extends 'base.html' %}

{% block title %}Enter Exam Results{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Enter Results: {{ exam.title }}</h3>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <strong>Class:</strong> {{ exam.class.name }} |
                <strong>Subject:</strong> {{ exam.subject.name }} |
                <strong>Date:</strong> {{ exam.exam_date.strftime('%d-%m-%Y') }} |
                <strong>Total Marks:</strong> {{ exam.total_marks }} |
                <strong>Passing Marks:</strong> {{ exam.passing_marks }}
            </div>

            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Roll No</th>
                                <th>Student Name</th>
                                <th>Marks</th>
                                <th>Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr>
                                <td>{{ student.roll_number }}</td>
                                <td>{{ student.user.first_name }} {{ student.user.last_name }}</td>
                                <td>
                                    <input type="number" class="form-control" name="marks_{{ student.user_id }}"
                                        value="{{ results.get(student.user_id, {}).get('marks', '') }}" min="0"
                                        max="{{ exam.total_marks }}" required>
                                </td>
                                <td>
                                    <input type="text" class="form-control" name="remarks_{{ student.user_id }}"
                                        value="{{ results.get(student.user_id, {}).get('remarks', '') }}">
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="4" class="text-center">No students found in this class</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                    <a href="{{ url_for('exam.exam_detail', exam_id=exam.id) }}"
                        class="btn btn-secondary me-md-2">Cancel</a>
                    <button type="submit" class="btn btn-primary">Save Results</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}